!function(e){function t(e,t){return"all"==t?e:e.filter(function(e){return t.toLowerCase().indexOf(e)!=-1})}var n="application/x-dnd",i="application/json",r="Text",a=["move","copy","link"];e.directive("dndDraggable",["$parse","$timeout",function(e,s){return function(l,u,c){u.attr("draggable","true"),c.dndDisableIf&&l.$watch(c.dndDisableIf,function(e){u.attr("draggable",!e)}),u.on("dragstart",function(d){if(d=d.originalEvent||d,"false"==u.attr("draggable"))return!0;o.isDragging=!0,o.itemType=c.dndType&&l.$eval(c.dndType).toLowerCase(),o.dropEffect="none",o.effectAllowed=c.dndEffectAllowed||a[0],d.dataTransfer.effectAllowed=o.effectAllowed;var f=l.$eval(c.dndDraggable),p=n+(o.itemType?"-"+o.itemType:"");try{d.dataTransfer.setData(p,angular.toJson(f))}catch(e){var h=angular.toJson({item:f,type:o.itemType});try{d.dataTransfer.setData(i,h)}catch(e){var g=t(a,o.effectAllowed);d.dataTransfer.effectAllowed=g[0],d.dataTransfer.setData(r,h)}}if(u.addClass("dndDragging"),s(function(){u.addClass("dndDraggingSource")},0),d._dndHandle&&d.dataTransfer.setDragImage&&d.dataTransfer.setDragImage(u[0],0,0),e(c.dndDragstart)(l,{event:d}),c.dndCallback){var m=e(c.dndCallback);o.callback=function(e){return m(l,e||{})}}d.stopPropagation()}),u.on("dragend",function(t){t=t.originalEvent||t,l.$apply(function(){var n=o.dropEffect,i={copy:"dndCopied",link:"dndLinked",move:"dndMoved",none:"dndCanceled"};e(c[i[n]])(l,{event:t}),e(c.dndDragend)(l,{event:t,dropEffect:n})}),o.isDragging=!1,o.callback=void 0,u.removeClass("dndDragging"),u.removeClass("dndDraggingSource"),t.stopPropagation(),s(function(){u.removeClass("dndDraggingSource")},0)}),u.on("click",function(t){c.dndSelected&&(t=t.originalEvent||t,l.$apply(function(){e(c.dndSelected)(l,{event:t})}),t.stopPropagation())}),u.on("selectstart",function(){this.dragDrop&&this.dragDrop()})}}]),e.directive("dndList",["$parse",function(e){return function(s,l,u){function c(e){if(!e)return r;for(var t=0;t<e.length;t++)if(e[t]==r||e[t]==i||e[t].substr(0,n.length)==n)return e[t];return null}function d(e){return o.isDragging?o.itemType||void 0:e==r||e==i?null:e&&e.substr(n.length+1)||void 0}function f(e){return!x.disabled&&(!(!x.externalSources&&!o.isDragging)&&(!x.allowedTypes||null===e||e&&x.allowedTypes.indexOf(e)!=-1))}function p(e,n){var i=a;return n||(i=t(i,e.dataTransfer.effectAllowed)),o.isDragging&&(i=t(i,o.effectAllowed)),u.dndEffectAllowed&&(i=t(i,u.dndEffectAllowed)),i.length?e.ctrlKey&&i.indexOf("copy")!=-1?"copy":e.altKey&&i.indexOf("link")!=-1?"link":i[0]:"none"}function h(){return w.remove(),l.removeClass("dndDragover"),!0}function g(t,n,i,r,a,l){return e(t)(s,{callback:o.callback,dropEffect:i,event:n,external:!o.isDragging,index:void 0!==a?a:m(),item:l||void 0,type:r})}function m(){return Array.prototype.indexOf.call(b.children,y)}function v(){var e;return angular.forEach(l.children(),function(t){var n=angular.element(t);n.hasClass("dndPlaceholder")&&(e=n)}),e||angular.element("<li class='dndPlaceholder'></li>")}var w=v();w.remove();var y=w[0],b=l[0],x={};l.on("dragenter",function(e){e=e.originalEvent||e;var t=u.dndAllowedTypes&&s.$eval(u.dndAllowedTypes);x={allowedTypes:angular.isArray(t)&&t.join("|").toLowerCase().split("|"),disabled:u.dndDisableIf&&s.$eval(u.dndDisableIf),externalSources:u.dndExternalSources&&s.$eval(u.dndExternalSources),horizontal:u.dndHorizontalList&&s.$eval(u.dndHorizontalList)};var n=c(e.dataTransfer.types);return!n||!f(d(n))||void e.preventDefault()}),l.on("dragover",function(e){e=e.originalEvent||e;var t=c(e.dataTransfer.types),n=d(t);if(!t||!f(n))return!0;if(y.parentNode!=b&&l.append(w),e.target!=b){for(var i=e.target;i.parentNode!=b&&i.parentNode;)i=i.parentNode;if(i.parentNode==b&&i!=y){var a=i.getBoundingClientRect();if(x.horizontal)var o=e.clientX<a.left+a.width/2;else var o=e.clientY<a.top+a.height/2;b.insertBefore(y,o?i:i.nextSibling)}}var s=t==r,m=p(e,s);return"none"==m?h():u.dndDragover&&!g(u.dndDragover,e,m,n)?h():(e.preventDefault(),s||(e.dataTransfer.dropEffect=m),l.addClass("dndDragover"),e.stopPropagation(),!1)}),l.on("drop",function(e){e=e.originalEvent||e;var t=c(e.dataTransfer.types),n=d(t);if(!t||!f(n))return!0;e.preventDefault();try{var a=JSON.parse(e.dataTransfer.getData(t))}catch(e){return h()}if((t==r||t==i)&&(n=a.type||void 0,a=a.item,!f(n)))return h();var l=t==r,v=p(e,l);if("none"==v)return h();var w=m();return u.dndDrop&&(a=g(u.dndDrop,e,v,n,w,a),!a)?h():(o.dropEffect=v,l||(e.dataTransfer.dropEffect=v),a!==!0&&s.$apply(function(){s.$eval(u.dndList).splice(w,0,a)}),g(u.dndInserted,e,v,n,w,a),h(),e.stopPropagation(),!1)}),l.on("dragleave",function(e){e=e.originalEvent||e;var t=document.elementFromPoint(e.clientX,e.clientY);b.contains(t)&&!e._dndPhShown?e._dndPhShown=!0:h()})}}]),e.directive("dndNodrag",function(){return function(e,t,n){t.attr("draggable","true"),t.on("dragstart",function(e){e=e.originalEvent||e,e._dndHandle||(e.dataTransfer.types&&e.dataTransfer.types.length||e.preventDefault(),e.stopPropagation())}),t.on("dragend",function(e){e=e.originalEvent||e,e._dndHandle||e.stopPropagation()})}}),e.directive("dndHandle",function(){return function(e,t,n){t.attr("draggable","true"),t.on("dragstart dragend",function(e){e=e.originalEvent||e,e._dndHandle=!0})}});var o={}}(angular.module("dndLists",[])),function(e,t,n){"use strict";function i(t){if(this.support=!("undefined"==typeof File||"undefined"==typeof Blob||"undefined"==typeof FileList||!Blob.prototype.slice&&!Blob.prototype.webkitSlice&&!Blob.prototype.mozSlice),this.support){this.supportDirectory=/Chrome/.test(e.navigator.userAgent),this.files=[],this.defaults={chunkSize:1048576,forceChunkSize:!1,simultaneousUploads:3,singleFile:!1,fileParameterName:"file",progressCallbacksInterval:500,speedSmoothingFactor:.1,query:{},headers:{},withCredentials:!1,preprocess:null,method:"multipart",testMethod:"GET",uploadMethod:"POST",prioritizeFirstAndLastChunk:!1,allowDuplicateUploads:!1,target:"/",testChunks:!0,generateUniqueIdentifier:null,maxChunkRetries:0,chunkRetryInterval:null,permanentErrors:[404,413,415,500,501],successStatuses:[200,201,202],onDropStopPropagation:!1,initFileFn:null,readFileFn:a},this.opts={},this.events={};var n=this;this.onDrop=function(e){n.opts.onDropStopPropagation&&e.stopPropagation(),e.preventDefault();var t=e.dataTransfer;t.items&&t.items[0]&&t.items[0].webkitGetAsEntry?n.webkitReadDataTransfer(e):n.addFiles(t.files,e)},this.preventEvent=function(e){e.preventDefault()},this.opts=i.extend({},this.defaults,t||{})}}function r(e,t){this.flowObj=e,this.bytes=null,this.file=t,this.name=t.fileName||t.name,this.size=t.size,this.relativePath=t.relativePath||t.webkitRelativePath||this.name,this.uniqueIdentifier=e.generateUniqueIdentifier(t),this.chunks=[],this.paused=!1,this.error=!1,this.averageSpeed=0,this.currentSpeed=0,this._lastProgressCallback=Date.now(),this._prevUploadedSize=0,this._prevProgress=0,this.bootstrap()}function a(e,t,n,i,r){var a="slice";e.file.slice?a="slice":e.file.mozSlice?a="mozSlice":e.file.webkitSlice&&(a="webkitSlice"),r.readFinished(e.file[a](t,n,i))}function o(e,t,n){this.flowObj=e,this.fileObj=t,this.offset=n,this.tested=!1,this.retries=0,this.pendingRetry=!1,this.preprocessState=0,this.readState=0,this.loaded=0,this.total=0,this.chunkSize=this.flowObj.opts.chunkSize,this.startByte=this.offset*this.chunkSize,this.computeEndByte=function(){var e=Math.min(this.fileObj.size,(this.offset+1)*this.chunkSize);return this.fileObj.size-e<this.chunkSize&&!this.flowObj.opts.forceChunkSize&&(e=this.fileObj.size),e},this.endByte=this.computeEndByte(),this.xhr=null;var i=this;this.event=function(e,t){t=Array.prototype.slice.call(arguments),t.unshift(i),i.fileObj.chunkEvent.apply(i.fileObj,t)},this.progressHandler=function(e){e.lengthComputable&&(i.loaded=e.loaded,i.total=e.total),i.event("progress",e)},this.testHandler=function(e){var t=i.status(!0);"error"===t?(i.event(t,i.message()),i.flowObj.uploadNextChunk()):"success"===t?(i.tested=!0,i.event(t,i.message()),i.flowObj.uploadNextChunk()):i.fileObj.paused||(i.tested=!0,i.send())},this.doneHandler=function(e){var t=i.status();if("success"===t||"error"===t)delete this.data,i.event(t,i.message()),i.flowObj.uploadNextChunk();else{i.event("retry",i.message()),i.pendingRetry=!0,i.abort(),i.retries++;var n=i.flowObj.opts.chunkRetryInterval;null!==n?setTimeout(function(){i.send()},n):i.send()}}}function s(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}function l(e,t){return"function"==typeof e&&(t=Array.prototype.slice.call(arguments),e=e.apply(null,t.slice(1))),e}function u(e,t){setTimeout(e.bind(t),0)}function c(e,t){return d(arguments,function(t){t!==e&&d(t,function(t,n){e[n]=t})}),e}function d(e,t,n){if(e){var i;if("undefined"!=typeof e.length){for(i=0;i<e.length;i++)if(t.call(n,e[i],i)===!1)return}else for(i in e)if(e.hasOwnProperty(i)&&t.call(n,e[i],i)===!1)return}}var f=e.navigator.msPointerEnabled;i.prototype={on:function(e,t){e=e.toLowerCase(),this.events.hasOwnProperty(e)||(this.events[e]=[]),this.events[e].push(t)},off:function(e,t){e!==n?(e=e.toLowerCase(),t!==n?this.events.hasOwnProperty(e)&&s(this.events[e],t):delete this.events[e]):this.events={}},fire:function(e,t){t=Array.prototype.slice.call(arguments),e=e.toLowerCase();var n=!1;return this.events.hasOwnProperty(e)&&d(this.events[e],function(e){n=e.apply(this,t.slice(1))===!1||n},this),"catchall"!=e&&(t.unshift("catchAll"),n=this.fire.apply(this,t)===!1||n),!n},webkitReadDataTransfer:function(e){function t(e){e.readEntries(function(a){a.length?(o+=a.length,d(a,function(e){if(e.isFile){var r=e.fullPath;e.file(function(e){n(e,r)},i)}else e.isDirectory&&t(e.createReader())}),t(e)):r()},i)}function n(e,t){e.relativePath=t.substring(1),s.push(e),r()}function i(e){throw e}function r(){0==--o&&a.addFiles(s,e)}var a=this,o=e.dataTransfer.items.length,s=[];d(e.dataTransfer.items,function(e){var i=e.webkitGetAsEntry();return i?void(i.isFile?n(e.getAsFile(),i.fullPath):t(i.createReader())):void r()})},generateUniqueIdentifier:function(e){var t=this.opts.generateUniqueIdentifier;if("function"==typeof t)return t(e);var n=e.relativePath||e.webkitRelativePath||e.fileName||e.name;return e.size+"-"+n.replace(/[^0-9a-zA-Z_-]/gim,"")},uploadNextChunk:function(e){var t=!1;if(this.opts.prioritizeFirstAndLastChunk&&(d(this.files,function(e){return!e.paused&&e.chunks.length&&"pending"===e.chunks[0].status()?(e.chunks[0].send(),t=!0,!1):!e.paused&&e.chunks.length>1&&"pending"===e.chunks[e.chunks.length-1].status()?(e.chunks[e.chunks.length-1].send(),t=!0,!1):void 0}),t))return t;if(d(this.files,function(e){if(e.paused||d(e.chunks,function(e){if("pending"===e.status())return e.send(),t=!0,!1}),t)return!1}),t)return!0;var n=!1;return d(this.files,function(e){if(!e.isComplete())return n=!0,!1}),n||e||u(function(){this.fire("complete")},this),!1},assignBrowse:function(e,n,i,r){e instanceof Element&&(e=[e]),d(e,function(e){var a;"INPUT"===e.tagName&&"file"===e.type?a=e:(a=t.createElement("input"),a.setAttribute("type","file"),c(a.style,{visibility:"hidden",position:"absolute",width:"1px",height:"1px"}),e.appendChild(a),e.addEventListener("click",function(){a.click()},!1)),this.opts.singleFile||i||a.setAttribute("multiple","multiple"),n&&a.setAttribute("webkitdirectory","webkitdirectory"),d(r,function(e,t){a.setAttribute(t,e)});var o=this;a.addEventListener("change",function(e){e.target.value&&(o.addFiles(e.target.files,e),e.target.value="")},!1)},this)},assignDrop:function(e){"undefined"==typeof e.length&&(e=[e]),d(e,function(e){e.addEventListener("dragover",this.preventEvent,!1),e.addEventListener("dragenter",this.preventEvent,!1),e.addEventListener("drop",this.onDrop,!1)},this)},unAssignDrop:function(e){"undefined"==typeof e.length&&(e=[e]),d(e,function(e){e.removeEventListener("dragover",this.preventEvent),e.removeEventListener("dragenter",this.preventEvent),e.removeEventListener("drop",this.onDrop)},this)},isUploading:function(){var e=!1;return d(this.files,function(t){if(t.isUploading())return e=!0,!1}),e},_shouldUploadNext:function(){var e=0,t=!0,n=this.opts.simultaneousUploads;return d(this.files,function(i){d(i.chunks,function(i){if("uploading"===i.status()&&(e++,e>=n))return t=!1,!1})}),t&&e},upload:function(){var e=this._shouldUploadNext();if(e!==!1){this.fire("uploadStart");for(var t=!1,n=1;n<=this.opts.simultaneousUploads-e;n++)t=this.uploadNextChunk(!0)||t;t||u(function(){this.fire("complete")},this)}},resume:function(){d(this.files,function(e){e.resume()})},pause:function(){d(this.files,function(e){e.pause()})},cancel:function(){for(var e=this.files.length-1;e>=0;e--)this.files[e].cancel()},progress:function(){var e=0,t=0;return d(this.files,function(n){e+=n.progress()*n.size,t+=n.size}),t>0?e/t:0},addFile:function(e,t){this.addFiles([e],t)},addFiles:function(e,t){var n=[];d(e,function(e){if((!f||f&&e.size>0)&&(e.size%4096!==0||"."!==e.name&&"."!==e.fileName)&&(this.opts.allowDuplicateUploads||!this.getFromUniqueIdentifier(this.generateUniqueIdentifier(e)))){var i=new r(this,e);this.fire("fileAdded",i,t)&&n.push(i)}},this),this.fire("filesAdded",n,t)&&(d(n,function(e){this.opts.singleFile&&this.files.length>0&&this.removeFile(this.files[0]),this.files.push(e)},this),this.fire("filesSubmitted",n,t))},removeFile:function(e){for(var t=this.files.length-1;t>=0;t--)this.files[t]===e&&(this.files.splice(t,1),e.abort(),this.fire("fileRemoved",e))},getFromUniqueIdentifier:function(e){var t=!1;return d(this.files,function(n){n.uniqueIdentifier===e&&(t=n)}),t},getSize:function(){var e=0;return d(this.files,function(t){e+=t.size}),e},sizeUploaded:function(){var e=0;return d(this.files,function(t){e+=t.sizeUploaded()}),e},timeRemaining:function(){var e=0,t=0;return d(this.files,function(n){n.paused||n.error||(e+=n.size-n.sizeUploaded(),t+=n.averageSpeed)}),e&&!t?Number.POSITIVE_INFINITY:e||t?Math.floor(e/t):0}},r.prototype={measureSpeed:function(){var e=Date.now()-this._lastProgressCallback;if(e){var t=this.flowObj.opts.speedSmoothingFactor,n=this.sizeUploaded();this.currentSpeed=Math.max((n-this._prevUploadedSize)/e*1e3,0),this.averageSpeed=t*this.currentSpeed+(1-t)*this.averageSpeed,this._prevUploadedSize=n}},chunkEvent:function(e,t,n){switch(t){case"progress":if(Date.now()-this._lastProgressCallback<this.flowObj.opts.progressCallbacksInterval)break;this.measureSpeed(),this.flowObj.fire("fileProgress",this,e),this.flowObj.fire("progress"),this._lastProgressCallback=Date.now();break;case"error":this.error=!0,this.abort(!0),this.flowObj.fire("fileError",this,n,e),this.flowObj.fire("error",n,this,e);break;case"success":if(this.error)return;this.measureSpeed(),this.flowObj.fire("fileProgress",this,e),this.flowObj.fire("progress"),this._lastProgressCallback=Date.now(),this.isComplete()&&(this.currentSpeed=0,this.averageSpeed=0,this.flowObj.fire("fileSuccess",this,n,e));break;case"retry":this.flowObj.fire("fileRetry",this,e)}},pause:function(){this.paused=!0,this.abort()},resume:function(){this.paused=!1,this.flowObj.upload()},abort:function(e){this.currentSpeed=0,this.averageSpeed=0;var t=this.chunks;e&&(this.chunks=[]),d(t,function(e){"uploading"===e.status()&&(e.abort(),this.flowObj.uploadNextChunk())},this)},cancel:function(){this.flowObj.removeFile(this)},retry:function(){this.bootstrap(),this.flowObj.upload()},bootstrap:function(){"function"==typeof this.flowObj.opts.initFileFn&&this.flowObj.opts.initFileFn(this),this.abort(!0),this.error=!1,this._prevProgress=0;for(var e=this.flowObj.opts.forceChunkSize?Math.ceil:Math.floor,t=Math.max(e(this.size/this.flowObj.opts.chunkSize),1),n=0;n<t;n++)this.chunks.push(new o(this.flowObj,this,n))},progress:function(){if(this.error)return 1;if(1===this.chunks.length)return this._prevProgress=Math.max(this._prevProgress,this.chunks[0].progress()),this._prevProgress;var e=0;d(this.chunks,function(t){e+=t.progress()*(t.endByte-t.startByte)});var t=e/this.size;return this._prevProgress=Math.max(this._prevProgress,t>.9999?1:t),this._prevProgress},isUploading:function(){var e=!1;return d(this.chunks,function(t){if("uploading"===t.status())return e=!0,!1}),e},isComplete:function(){var e=!1;return d(this.chunks,function(t){var n=t.status();if("pending"===n||"uploading"===n||"reading"===n||1===t.preprocessState||1===t.readState)return e=!0,!1}),!e},sizeUploaded:function(){var e=0;return d(this.chunks,function(t){e+=t.sizeUploaded()}),e},timeRemaining:function(){if(this.paused||this.error)return 0;var e=this.size-this.sizeUploaded();return e&&!this.averageSpeed?Number.POSITIVE_INFINITY:e||this.averageSpeed?Math.floor(e/this.averageSpeed):0},getType:function(){return this.file.type&&this.file.type.split("/")[1]},getExtension:function(){return this.name.substr((~-this.name.lastIndexOf(".")>>>0)+2).toLowerCase()}},o.prototype={getParams:function(){return{flowChunkNumber:this.offset+1,flowChunkSize:this.flowObj.opts.chunkSize,flowCurrentChunkSize:this.endByte-this.startByte,flowTotalSize:this.fileObj.size,flowIdentifier:this.fileObj.uniqueIdentifier,flowFilename:this.fileObj.name,flowRelativePath:this.fileObj.relativePath,flowTotalChunks:this.fileObj.chunks.length}},getTarget:function(e,t){return e+=e.indexOf("?")<0?"?":"&",e+t.join("&")},test:function(){this.xhr=new XMLHttpRequest,this.xhr.addEventListener("load",this.testHandler,!1),this.xhr.addEventListener("error",this.testHandler,!1);var e=l(this.flowObj.opts.testMethod,this.fileObj,this),t=this.prepareXhrRequest(e,!0);this.xhr.send(t)},preprocessFinished:function(){this.endByte=this.computeEndByte(),this.preprocessState=2,this.send()},readFinished:function(e){this.readState=2,this.bytes=e,this.send()},send:function(){var e=this.flowObj.opts.preprocess,t=this.flowObj.opts.readFileFn;if("function"==typeof e)switch(this.preprocessState){case 0:return this.preprocessState=1,void e(this);case 1:return}switch(this.readState){case 0:return this.readState=1,void t(this.fileObj,this.startByte,this.endByte,this.fileObj.file.type,this);case 1:return}if(this.flowObj.opts.testChunks&&!this.tested)return void this.test();this.loaded=0,this.total=0,this.pendingRetry=!1,this.xhr=new XMLHttpRequest,this.xhr.upload.addEventListener("progress",this.progressHandler,!1),this.xhr.addEventListener("load",this.doneHandler,!1),this.xhr.addEventListener("error",this.doneHandler,!1);var n=l(this.flowObj.opts.uploadMethod,this.fileObj,this),i=this.prepareXhrRequest(n,!1,this.flowObj.opts.method,this.bytes);this.xhr.send(i)},abort:function(){var e=this.xhr;this.xhr=null,e&&e.abort()},status:function(e){return 1===this.readState?"reading":this.pendingRetry||1===this.preprocessState?"uploading":this.xhr?this.xhr.readyState<4?"uploading":this.flowObj.opts.successStatuses.indexOf(this.xhr.status)>-1?"success":this.flowObj.opts.permanentErrors.indexOf(this.xhr.status)>-1||!e&&this.retries>=this.flowObj.opts.maxChunkRetries?"error":(this.abort(),"pending"):"pending"},message:function(){return this.xhr?this.xhr.responseText:""},progress:function(){if(this.pendingRetry)return 0;var e=this.status();return"success"===e||"error"===e?1:"pending"===e?0:this.total>0?this.loaded/this.total:0},sizeUploaded:function(){var e=this.endByte-this.startByte;return"success"!==this.status()&&(e=this.progress()*e),e},prepareXhrRequest:function(e,t,n,i){var r=l(this.flowObj.opts.query,this.fileObj,this,t);r=c(r,this.getParams());var a=l(this.flowObj.opts.target,this.fileObj,this,t),o=null;if("GET"===e||"octet"===n){var s=[];d(r,function(e,t){s.push([encodeURIComponent(t),encodeURIComponent(e)].join("="))}),a=this.getTarget(a,s),o=i||null}else o=new FormData,d(r,function(e,t){o.append(t,e)}),o.append(this.flowObj.opts.fileParameterName,i,this.fileObj.file.name);return this.xhr.open(e,a,!0),this.xhr.withCredentials=this.flowObj.opts.withCredentials,d(l(this.flowObj.opts.headers,this.fileObj,this,t),function(e,t){this.xhr.setRequestHeader(t,e)},this),o}},i.evalOpts=l,i.extend=c,i.each=d,i.FlowFile=r,i.FlowChunk=o,i.version="2.11.2","object"==typeof module&&module&&"object"==typeof module.exports?module.exports=i:(e.Flow=i,"function"==typeof define&&define.amd&&define("flow",[],function(){return i}))}(window,document),angular.module("flow.provider",[]).provider("flowFactory",function(){"use strict";this.defaults={},this.factory=function(e){return new Flow(e)},this.events=[],this.on=function(e,t){this.events.push([e,t])},this.$get=function(){var e=this.factory,t=this.defaults,n=this.events;return{create:function(i){var r=e(angular.extend({},t,i));return angular.forEach(n,function(e){r.on(e[0],e[1])}),r}}}}),angular.module("flow.init",["flow.provider"]).controller("flowCtrl",["$scope","$attrs","$parse","flowFactory",function(e,t,n,i){var r=angular.extend({},e.$eval(t.flowInit)),a=e.$eval(t.flowObject)||i.create(r),o=function(t){var n=Array.prototype.slice.call(arguments);n.shift();var i=e.$broadcast.apply(e,["flow::"+t,a].concat(n));if({progress:1,filesSubmitted:1,fileSuccess:1,fileError:1,complete:1}[t]&&e.$apply(),i.defaultPrevented)return!1};a.on("catchAll",o),e.$on("$destroy",function(){a.off("catchAll",o)}),e.$flow=a,t.hasOwnProperty("flowName")&&(n(t.flowName).assign(e,a),e.$on("$destroy",function(){n(t.flowName).assign(e)}))}]).directive("flowInit",[function(){return{scope:!0,controller:"flowCtrl"}}]),angular.module("flow.btn",["flow.init"]).directive("flowBtn",[function(){return{restrict:"EA",scope:!1,require:"^flowInit",link:function(e,t,n){var i=n.hasOwnProperty("flowDirectory"),r=n.hasOwnProperty("flowSingleFile"),a=n.hasOwnProperty("flowAttrs")&&e.$eval(n.flowAttrs);e.$flow.assignBrowse(t,i,r,a)}}}]),angular.module("flow.dragEvents",["flow.init"]).directive("flowPreventDrop",function(){return{scope:!1,link:function(e,t,n){t.bind("drop dragover",function(e){e.preventDefault()})}}}).directive("flowDragEnter",["$timeout",function(e){return{scope:!1,link:function(t,n,i){function r(e){var t=!1,n=e.dataTransfer||e.originalEvent.dataTransfer;return angular.forEach(n&&n.types,function(e){"Files"===e&&(t=!0)}),t}var a,o=!1;n.bind("dragover",function(n){r(n)&&(o||(t.$apply(i.flowDragEnter),o=!0),e.cancel(a),n.preventDefault())}),n.bind("dragleave drop",function(n){e.cancel(a),a=e(function(){t.$eval(i.flowDragLeave),a=null,o=!1},100)})}}}]),angular.module("flow.drop",["flow.init"]).directive("flowDrop",function(){return{scope:!1,require:"^flowInit",link:function(e,t,n){function i(){e.$flow.assignDrop(t)}function r(){e.$flow.unAssignDrop(t)}n.flowDropEnabled?e.$watch(n.flowDropEnabled,function(e){e?i():r()}):i()}}}),!function(e){"use strict";function t(e){return e.charAt(0).toUpperCase()+e.slice(1)}var n=e.module("flow.events",["flow.init"]),i={fileSuccess:["$file","$message"],fileProgress:["$file"],fileAdded:["$file","$event"],filesAdded:["$files","$event"],filesSubmitted:["$files","$event"],fileRetry:["$file"],fileError:["$file","$message"],uploadStart:[],complete:[],progress:[],error:["$message","$file"]};e.forEach(i,function(i,r){var a="flow"+t(r);"flowUploadStart"==a&&(a="flowUploadStarted"),n.directive(a,[function(){return{require:"^flowInit",controller:["$scope","$attrs",function(t,n){t.$on("flow::"+r,function(){var r=Array.prototype.slice.call(arguments),o=r.shift();if(t.$flow===r.shift()){var s={};e.forEach(i,function(e,t){s[e]=r[t]}),t.$eval(n[a],s)===!1&&o.preventDefault()}})}]}}])})}(angular),angular.module("flow.img",["flow.init"]).directive("flowImg",[function(){return{scope:!1,require:"^flowInit",link:function(e,t,n){var i=n.flowImg;e.$watch(i,function(t){if(t){var i=new FileReader;i.readAsDataURL(t.file),i.onload=function(t){e.$apply(function(){n.$set("src",t.target.result)})}}})}}}]),angular.module("flow.transfers",["flow.init"]).directive("flowTransfers",[function(){return{scope:!0,require:"^flowInit",link:function(e){e.transfers=e.$flow.files}}}]),angular.module("flow",["flow.provider","flow.init","flow.events","flow.btn","flow.drop","flow.transfers","flow.img","flow.dragEvents"]),angular.module("angularResizable",[]).directive("resizable",function(){function e(e){void 0===t?(t=e,setTimeout(function(){t(),t=void 0},100)):t=e}var t;return{restrict:"AE",scope:{rDirections:"=",rCenteredX:"=",rCenteredY:"=",rWidth:"=",rHeight:"=",rFlex:"=",rGrabber:"@",rDisabled:"@",rNoThrottle:"="},link:function(t,n,i){var r="flexBasis"in document.documentElement.style?"flexBasis":"webkitFlexBasis"in document.documentElement.style?"webkitFlexBasis":"msFlexPreferredSize"in document.documentElement.style?"msFlexPreferredSize":"flexBasis";t.$watch("rWidth",function(e){n[0].style[t.rFlex?r:"width"]=t.rWidth+"px"}),t.$watch("rHeight",function(e){n[0].style[t.rFlex?r:"height"]=t.rHeight+"px"}),n.addClass("resizable");var a,o,s,l,u,c=window.getComputedStyle(n[0],null),d=t.rDirections||["right"],f=t.rCenteredX?2:1,p=t.rCenteredY?2:1,h=t.rGrabber?t.rGrabber:"<span></span>",g={},m=function(e){g.width=!1,g.height=!1,"x"===u?g.width=parseInt(n[0].style[t.rFlex?r:"width"]):g.height=parseInt(n[0].style[t.rFlex?r:"height"]),g.id=n[0].id,g.evt=e},v=function(e){return e.touches?e.touches[0].clientX:e.clientX},w=function(e){return e.touches?e.touches[0].clientY:e.clientY},y=function(i){function c(){t.$emit("angular-resizable.resizing",g)}var d,h="x"===u?s-v(i):s-w(i);switch(l){case"top":d=t.rFlex?r:"height",n[0].style[d]=o+h*p+"px";break;case"bottom":d=t.rFlex?r:"height",n[0].style[d]=o-h*p+"px";break;case"right":d=t.rFlex?r:"width",n[0].style[d]=a-h*f+"px";break;case"left":d=t.rFlex?r:"width",n[0].style[d]=a+h*f+"px"}m(i),t.rNoThrottle?c():e(c)},b=function(e){m(),t.$emit("angular-resizable.resizeEnd",g),t.$apply(),document.removeEventListener("mouseup",b,!1),document.removeEventListener("mousemove",y,!1),document.removeEventListener("touchend",b,!1),document.removeEventListener("touchmove",y,!1),n.removeClass("no-transition")},x=function(e,i){l=i,u="left"===l||"right"===l?"x":"y",s="x"===u?v(e):w(e),a=parseInt(c.getPropertyValue("width")),o=parseInt(c.getPropertyValue("height")),n.addClass("no-transition"),document.addEventListener("mouseup",b,!1),document.addEventListener("mousemove",y,!1),document.addEventListener("touchend",b,!1),document.addEventListener("touchmove",y,!1),e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,m(e),t.$emit("angular-resizable.resizeStart",g),t.$apply()};d.forEach(function(e){var i=document.createElement("div");i.setAttribute("class","rg-"+e),i.innerHTML=h,n[0].appendChild(i),i.ondragstart=function(){return!1};var r=function(n){var i="true"===t.rDisabled;i||1!==n.which&&!n.touches||x(n,e)};i.addEventListener("mousedown",r,!1),i.addEventListener("touchstart",r,!1)})}}}),function(){"use strict";var e={backspace:8,tab:9,enter:13,escape:27,space:32,up:38,down:40,left:37,right:39,delete:46,comma:188},t=9007199254740991,n=["text","email","url"],i=angular.module("ngTagsInput",[]);i.directive("tagsInput",["$timeout","$document","$window","$q","tagsInputConfig","tiUtil",function(i,r,a,o,s,l){function u(e,t,n,i){var r,a,s,u,c={};return r=function(t){return l.safeToString(t[e.displayProperty])},a=function(t,n){t[e.displayProperty]=n},s=function(t){var i=r(t),a=i&&i.length>=e.minLength&&i.length<=e.maxLength&&e.allowedTagsPattern.test(i)&&!l.findInObjectArray(c.items,t,e.keyProperty||e.displayProperty);return o.when(a&&n({$tag:t})).then(l.promisifyValue)},u=function(e){return o.when(i({$tag:e})).then(l.promisifyValue)},c.items=[],c.addText=function(e){var t={};return a(t,e),c.add(t)},c.add=function(n){var i=r(n);return e.replaceSpacesWithDashes&&(i=l.replaceSpacesWithDashes(i)),a(n,i),s(n).then(function(){c.items.push(n),t.trigger("tag-added",{$tag:n})}).catch(function(){i&&t.trigger("invalid-tag",{$tag:n})})},c.remove=function(e){var n=c.items[e];return u(n).then(function(){return c.items.splice(e,1),c.clearSelection(),t.trigger("tag-removed",{$tag:n}),n})},c.select=function(e){e<0?e=c.items.length-1:e>=c.items.length&&(e=0),c.index=e,c.selected=c.items[e]},c.selectPrior=function(){c.select(--c.index)},c.selectNext=function(){c.select(++c.index)},c.removeSelected=function(){return c.remove(c.index)},c.clearSelection=function(){c.selected=null,c.index=-1},c.clearSelection(),c}function c(e){return n.indexOf(e)!==-1}return{restrict:"E",require:"ngModel",scope:{tags:"=ngModel",text:"=?",templateScope:"=?",tagClass:"&",onTagAdding:"&",onTagAdded:"&",onInvalidTag:"&",onTagRemoving:"&",onTagRemoved:"&",onTagClicked:"&"},replace:!1,transclude:!0,templateUrl:"ngTagsInput/tags-input.html",controller:["$scope","$attrs","$element",function(e,n,i){e.events=l.simplePubSub(),s.load("tagsInput",e,n,{template:[String,"ngTagsInput/tag-item.html"],type:[String,"text",c],placeholder:[String,"Add a tag"],tabindex:[Number,null],removeTagSymbol:[String,String.fromCharCode(215)],replaceSpacesWithDashes:[Boolean,!0],minLength:[Number,3],maxLength:[Number,t],addOnEnter:[Boolean,!0],addOnSpace:[Boolean,!1],addOnComma:[Boolean,!0],addOnBlur:[Boolean,!0],addOnPaste:[Boolean,!1],pasteSplitPattern:[RegExp,/,/],allowedTagsPattern:[RegExp,/.+/],enableEditingLastTag:[Boolean,!1],minTags:[Number,0],maxTags:[Number,t],displayProperty:[String,"text"],keyProperty:[String,""],allowLeftoverText:[Boolean,!1],addFromAutocompleteOnly:[Boolean,!1],spellcheck:[Boolean,!0]}),e.tagList=new u(e.options,e.events,l.handleUndefinedResult(e.onTagAdding,!0),l.handleUndefinedResult(e.onTagRemoving,!0)),this.registerAutocomplete=function(){i.find("input");return{addTag:function(t){return e.tagList.add(t)},getTags:function(){return e.tagList.items},getCurrentTagText:function(){return e.newTag.text()},getOptions:function(){return e.options},getTemplateScope:function(){return e.templateScope},on:function(t,n){return e.events.on(t,n,!0),this}}},this.registerTagItem=function(){return{getOptions:function(){return e.options},removeTag:function(t){e.disabled||e.tagList.remove(t)}}}}],link:function(t,n,o,s){var u,c,d=[e.enter,e.comma,e.space,e.backspace,e.delete,e.left,e.right],f=t.tagList,p=t.events,h=t.options,g=n.find("input"),m=["minTags","maxTags","allowLeftoverText"];u=function(){s.$setValidity("maxTags",f.items.length<=h.maxTags),s.$setValidity("minTags",f.items.length>=h.minTags),s.$setValidity("leftoverText",!(!t.hasFocus&&!h.allowLeftoverText)||!t.newTag.text())},c=function(){i(function(){g[0].focus()})},s.$isEmpty=function(e){return!e||!e.length},t.newTag={text:function(e){return angular.isDefined(e)?(t.text=e,void p.trigger("input-change",e)):t.text||""},invalid:null},t.track=function(e){return e[h.keyProperty||h.displayProperty]},t.getTagClass=function(e,n){var i=e===f.selected;return[t.tagClass({$tag:e,$index:n,$selected:i}),{selected:i}]},t.$watch("tags",function(e){e?(f.items=l.makeObjectArray(e,h.displayProperty),t.tags=f.items):f.items=[]}),t.$watch("tags.length",function(){u(),s.$validate()}),o.$observe("disabled",function(e){t.disabled=e}),t.eventHandlers={input:{keydown:function(e){p.trigger("input-keydown",e)},focus:function(){t.hasFocus||(t.hasFocus=!0,p.trigger("input-focus"))},blur:function(){i(function(){var e=r.prop("activeElement"),i=e===g[0],a=n[0].contains(e);!i&&a||(t.hasFocus=!1,p.trigger("input-blur"))})},paste:function(e){e.getTextData=function(){var t=e.clipboardData||e.originalEvent&&e.originalEvent.clipboardData;return t?t.getData("text/plain"):a.clipboardData.getData("Text")},p.trigger("input-paste",e)}},host:{click:function(){t.disabled||c()}},tag:{click:function(e){p.trigger("tag-clicked",{$tag:e})}}},p.on("tag-added",t.onTagAdded).on("invalid-tag",t.onInvalidTag).on("tag-removed",t.onTagRemoved).on("tag-clicked",t.onTagClicked).on("tag-added",function(){t.newTag.text("")}).on("tag-added tag-removed",function(){t.tags=f.items,s.$setDirty(),c()}).on("invalid-tag",function(){t.newTag.invalid=!0}).on("option-change",function(e){m.indexOf(e.name)!==-1&&u()}).on("input-change",function(){f.clearSelection(),t.newTag.invalid=null}).on("input-focus",function(){n.triggerHandler("focus"),s.$setValidity("leftoverText",!0)}).on("input-blur",function(){h.addOnBlur&&!h.addFromAutocompleteOnly&&f.addText(t.newTag.text()),n.triggerHandler("blur"),u()}).on("input-keydown",function(n){var i,r,a,o,s=n.keyCode,u={};
l.isModifierOn(n)||d.indexOf(s)===-1||(u[e.enter]=h.addOnEnter,u[e.comma]=h.addOnComma,u[e.space]=h.addOnSpace,i=!h.addFromAutocompleteOnly&&u[s],r=(s===e.backspace||s===e.delete)&&f.selected,o=s===e.backspace&&0===t.newTag.text().length&&h.enableEditingLastTag,a=(s===e.backspace||s===e.left||s===e.right)&&0===t.newTag.text().length&&!h.enableEditingLastTag,i?f.addText(t.newTag.text()):o?(f.selectPrior(),f.removeSelected().then(function(e){e&&t.newTag.text(e[h.displayProperty])})):r?f.removeSelected():a&&(s===e.left||s===e.backspace?f.selectPrior():s===e.right&&f.selectNext()),(i||a||r||o)&&n.preventDefault())}).on("input-paste",function(e){if(h.addOnPaste){var t=e.getTextData(),n=t.split(h.pasteSplitPattern);n.length>1&&(n.forEach(function(e){f.addText(e)}),e.preventDefault())}})}}}]),i.directive("tiTagItem",["tiUtil",function(e){return{restrict:"E",require:"^tagsInput",template:'<ng-include src="$$template"></ng-include>',scope:{$scope:"=scope",data:"="},link:function(t,n,i,r){var a=r.registerTagItem(),o=a.getOptions();t.$$template=o.template,t.$$removeTagSymbol=o.removeTagSymbol,t.$getDisplayText=function(){return e.safeToString(t.data[o.displayProperty])},t.$removeTag=function(){a.removeTag(t.$index)},t.$watch("$parent.$index",function(e){t.$index=e})}}}]),i.directive("autoComplete",["$document","$timeout","$sce","$q","tagsInputConfig","tiUtil",function(t,n,i,r,a,o){function s(e,t,n){var i,a,s,l={};return s=function(){return t.tagsInput.keyProperty||t.tagsInput.displayProperty},i=function(e,n){return e.filter(function(e){return!o.findInObjectArray(n,e,s(),function(e,n){return t.tagsInput.replaceSpacesWithDashes&&(e=o.replaceSpacesWithDashes(e),n=o.replaceSpacesWithDashes(n)),o.defaultComparer(e,n)})})},l.reset=function(){a=null,l.items=[],l.visible=!1,l.index=-1,l.selected=null,l.query=null},l.show=function(){t.selectFirstMatch?l.select(0):l.selected=null,l.visible=!0},l.load=o.debounce(function(n,u){l.query=n;var c=r.when(e({$query:n}));a=c,c.then(function(e){c===a&&(e=o.makeObjectArray(e.data||e,s()),e=i(e,u),l.items=e.slice(0,t.maxResultsToShow),l.items.length>0?l.show():l.reset())})},t.debounceDelay),l.selectNext=function(){l.select(++l.index)},l.selectPrior=function(){l.select(--l.index)},l.select=function(e){e<0?e=l.items.length-1:e>=l.items.length&&(e=0),l.index=e,l.selected=l.items[e],n.trigger("suggestion-selected",e)},l.reset(),l}function l(e,t){var n=e.find("li").eq(t),i=n.parent(),r=n.prop("offsetTop"),a=n.prop("offsetHeight"),o=i.prop("clientHeight"),s=i.prop("scrollTop");r<s?i.prop("scrollTop",r):r+a>o+s&&i.prop("scrollTop",r+a-o)}return{restrict:"E",require:"^tagsInput",scope:{source:"&",matchClass:"&"},templateUrl:"ngTagsInput/auto-complete.html",controller:["$scope","$element","$attrs",function(e,t,n){e.events=o.simplePubSub(),a.load("autoComplete",e,n,{template:[String,"ngTagsInput/auto-complete-match.html"],debounceDelay:[Number,100],minLength:[Number,3],highlightMatchedText:[Boolean,!0],maxResultsToShow:[Number,10],loadOnDownArrow:[Boolean,!1],loadOnEmpty:[Boolean,!1],loadOnFocus:[Boolean,!1],selectFirstMatch:[Boolean,!0],displayProperty:[String,""]}),e.suggestionList=new s(e.source,e.options,e.events),this.registerAutocompleteMatch=function(){return{getOptions:function(){return e.options},getQuery:function(){return e.suggestionList.query}}}}],link:function(t,n,i,r){var a,s=[e.enter,e.tab,e.escape,e.up,e.down],u=t.suggestionList,c=r.registerAutocomplete(),d=t.options,f=t.events;d.tagsInput=c.getOptions(),a=function(e){return e&&e.length>=d.minLength||!e&&d.loadOnEmpty},t.templateScope=c.getTemplateScope(),t.addSuggestionByIndex=function(e){u.select(e),t.addSuggestion()},t.addSuggestion=function(){var e=!1;return u.selected&&(c.addTag(angular.copy(u.selected)),u.reset(),e=!0),e},t.track=function(e){return e[d.tagsInput.keyProperty||d.tagsInput.displayProperty]},t.getSuggestionClass=function(e,n){var i=e===u.selected;return[t.matchClass({$match:e,$index:n,$selected:i}),{selected:i}]},c.on("tag-added tag-removed invalid-tag input-blur",function(){u.reset()}).on("input-change",function(e){a(e)?u.load(e,c.getTags()):u.reset()}).on("input-focus",function(){var e=c.getCurrentTagText();d.loadOnFocus&&a(e)&&u.load(e,c.getTags())}).on("input-keydown",function(n){var i=n.keyCode,r=!1;if(!o.isModifierOn(n)&&s.indexOf(i)!==-1)return u.visible?i===e.down?(u.selectNext(),r=!0):i===e.up?(u.selectPrior(),r=!0):i===e.escape?(u.reset(),r=!0):i!==e.enter&&i!==e.tab||(r=t.addSuggestion()):i===e.down&&t.options.loadOnDownArrow&&(u.load(c.getCurrentTagText(),c.getTags()),r=!0),r?(n.preventDefault(),n.stopImmediatePropagation(),!1):void 0}),f.on("suggestion-selected",function(e){l(n,e)})}}}]),i.directive("tiAutocompleteMatch",["$sce","tiUtil",function(e,t){return{restrict:"E",require:"^autoComplete",template:'<ng-include src="$$template"></ng-include>',scope:{$scope:"=scope",data:"="},link:function(n,i,r,a){var o=a.registerAutocompleteMatch(),s=o.getOptions();n.$$template=s.template,n.$index=n.$parent.$index,n.$highlight=function(n){return s.highlightMatchedText&&(n=t.safeHighlight(n,o.getQuery())),e.trustAsHtml(n)},n.$getDisplayText=function(){return t.safeToString(n.data[s.displayProperty||s.tagsInput.displayProperty])}}}}]),i.directive("tiTranscludeAppend",function(){return function(e,t,n,i,r){r(function(e){t.append(e)})}}),i.directive("tiAutosize",["tagsInputConfig",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,i,r){var a,o;e.getTextAutosizeThreshold();a=angular.element('<span class="input"></span>'),a.css("display","none").css("visibility","hidden").css("white-space","pre"),n.parent().append(a),o=function(e){var t=e;return angular.isString(t)&&0===t.length&&(t=i.placeholder),t&&(a.text(t),a.css("display",""),a.css("display","none")),e},r.$parsers.unshift(o),r.$formatters.unshift(o),i.$observe("placeholder",function(e){r.$modelValue||o(e)})}}}]),i.directive("tiBindAttrs",function(){return function(e,t,n){e.$watch(n.tiBindAttrs,function(e){angular.forEach(e,function(e,t){n.$set(t,e)})},!0)}}),i.provider("tagsInputConfig",function(){var e={},t={},n=3;this.setDefaults=function(t,n){return e[t]=n,this},this.setActiveInterpolation=function(e,n){return t[e]=n,this},this.setTextAutosizeThreshold=function(e){return n=e,this},this.$get=["$interpolate",function(i){var r={};return r[String]=function(e){return e},r[Number]=function(e){return parseInt(e,10)},r[Boolean]=function(e){return"true"===e.toLowerCase()},r[RegExp]=function(e){return new RegExp(e)},{load:function(n,a,o,s){var l=function(){return!0};a.options={},angular.forEach(s,function(s,u){var c,d,f,p,h,g;c=s[0],d=s[1],f=s[2]||l,p=r[c],h=function(){var t=e[n]&&e[n][u];return angular.isDefined(t)?t:d},g=function(e){a.options[u]=e&&f(e)?p(e):h()},t[n]&&t[n][u]?o.$observe(u,function(e){g(e),a.events.trigger("option-change",{name:u,newValue:e})}):g(o[u]&&i(o[u])(a.$parent))})},getTextAutosizeThreshold:function(){return n}}}]}),i.factory("tiUtil",["$timeout","$q",function(e,t){var n={};return n.debounce=function(t,n){var i;return function(){var r=arguments;e.cancel(i),i=e(function(){t.apply(null,r)},n)}},n.makeObjectArray=function(e,t){if(!angular.isArray(e)||0===e.length||angular.isObject(e[0]))return e;var n=[];return e.forEach(function(e){var i={};i[t]=e,n.push(i)}),n},n.findInObjectArray=function(e,t,i,r){var a=null;return r=r||n.defaultComparer,e.some(function(e){if(r(e[i],t[i]))return a=e,!0}),a},n.defaultComparer=function(e,t){return n.safeToString(e).toLowerCase()===n.safeToString(t).toLowerCase()},n.safeHighlight=function(e,t){function i(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}if(!t)return e;e=n.encodeHTML(e),t=n.encodeHTML(t);var r=new RegExp("&[^;]+;|"+i(t),"gi");return e.replace(r,function(e){return e.toLowerCase()===t.toLowerCase()?"<em>"+e+"</em>":e})},n.safeToString=function(e){return angular.isUndefined(e)||null==e?"":e.toString().trim()},n.encodeHTML=function(e){return n.safeToString(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},n.handleUndefinedResult=function(e,t){return function(){var n=e.apply(null,arguments);return angular.isUndefined(n)?t:n}},n.replaceSpacesWithDashes=function(e){return n.safeToString(e).replace(/\s/g,"-")},n.isModifierOn=function(e){return e.shiftKey||e.ctrlKey||e.altKey||e.metaKey},n.promisifyValue=function(e){return e=!!angular.isUndefined(e)||e,t[e?"when":"reject"]()},n.simplePubSub=function(){var e={};return{on:function(t,n,i){return t.split(" ").forEach(function(t){e[t]||(e[t]=[]);var r=i?[].unshift:[].push;r.call(e[t],n)}),this},trigger:function(t,i){var r=e[t]||[];return r.every(function(e){return n.handleUndefinedResult(e,!0)(i)}),this}}},n}]),i.run(["$templateCache",function(e){e.put("ngTagsInput/tags-input.html",'<div class="host" tabindex="-1" ng-click="eventHandlers.host.click()" ti-transclude-append><div class="tags" ng-class="{focused: hasFocus}"><ul class="tag-list"><li class="tag-item" ng-repeat="tag in tagList.items track by track(tag)" ng-class="getTagClass(tag, $index)" ng-click="eventHandlers.tag.click(tag)"><ti-tag-item scope="templateScope" data="::tag"></ti-tag-item></li></ul><input class="input" autocomplete="off" ng-model="newTag.text" ng-model-options="{getterSetter: true}" ng-keydown="eventHandlers.input.keydown($event)" ng-focus="eventHandlers.input.focus($event)" ng-blur="eventHandlers.input.blur($event)" ng-paste="eventHandlers.input.paste($event)" ng-trim="false" ng-class="{\'invalid-tag\': newTag.invalid}" ng-disabled="disabled" ti-bind-attrs="{type: options.type, placeholder: options.placeholder, tabindex: options.tabindex, spellcheck: options.spellcheck}" ti-autosize></div></div>'),e.put("ngTagsInput/tag-item.html",'<span ng-bind="$getDisplayText()"></span> <a class="remove-button" ng-click="$removeTag()" ng-bind="::$$removeTagSymbol"></a>'),e.put("ngTagsInput/auto-complete.html",'<div class="autocomplete" ng-if="suggestionList.visible"><ul class="suggestion-list"><li class="suggestion-item" ng-repeat="item in suggestionList.items track by track(item)" ng-class="getSuggestionClass(item, $index)" ng-click="addSuggestionByIndex($index)" ng-mouseenter="suggestionList.select($index)"><ti-autocomplete-match scope="templateScope" data="::item"></ti-autocomplete-match></li></ul></div>'),e.put("ngTagsInput/auto-complete-match.html",'<span ng-bind-html="$highlight($getDisplayText())"></span>')}])}(),angular.module("alpacaEditor",["firebase","dndLists","ngTagsInput","swiperRepeat","ngAnimate","flow","angularResizable","alpacaViewer","alpacaSchemas","alpacaTypes"]),angular.module("alpacaEditor").directive("alpacaForm",["$compile","$templateRequest",function(e,t){var n=function(n,i,r){t(n.model.template).then(function(t){var r=angular.element(t);i.after(r),e(r)(n)})};return{restrict:"E",link:n,scope:{model:"=",schema:"="}}}]),angular.module("alpacaEditor").controller("alpacaEditorController",["$scope","$templateList","$schemas","$timeout","$firebaseObject","$q",function(e,t,n,i,r,a){var o=firebase.database().ref().child("config");r(o).$bindTo(e,"config"),e.defaultTags=function(){var e=["blah","ahah"];return e},e.templates=t.templates,console.log(t),e.tabs=[{name:"surveys",icon:"view_module"},{name:"edit",icon:"mode_edit"},{name:"metadata",icon:"timeline"},{name:"settings",icon:"settings"}],e.tab=e.tabs[3],e.setTab=function(t){e.tab=t},e.survey={slides:{1:{id:1,title:"Slide 1",content:"Foo",template:"green"},2:{id:2,title:"Slide 2",content:"Bar",template:"orange"},3:{id:3,title:"Slide 3",content:"Fluf",template:"orange"}},nodes:{1:{kind:"slide",title:"Slide 1",content:"Foo",template:"green"},2:{kind:"folder",title:"Smoking"},3:{kind:"slide",title:"Slide 3",content:"Fluf",template:"orange"}},nodest:[{kind:"external",title:"Onboarding",contents:[{kind:"slide",title:"Welcome",content:"Foo",template:"green",readonly:!0},{kind:"slide",title:"Instructions",content:"Fluf",template:"orange",readonly:!0}]},{kind:"slide",title:"Slide 1",content:"Foo",template:"green",options:[{text:"Yes",correct:!0},{text:"No",correct:!1}]},{kind:"slide",title:"Slide 2",content:"Fluf",template:"orange"},{kind:"folder",title:"Smoking",contents:[{kind:"slide",title:"Nested Slide 1",content:"Foo",template:"green"},{kind:"slide",title:"Nested Slide 2",content:"Fluf",template:"orange"}]}]},e.selected=e.survey.nodest[1],e.schemas=n.schemas,e.maximized=!1,e.maximizePreview=function(t){$(".resizable-wrapper").toggleClass("minimized"),e.maximized=!e.maximized},e.devices={iphone:{name:"iPhone",width:480,height:720,material_icon:"smartphone"},desktop:{name:"Desktop",width:1920,height:1080,material_icon:"desktop_windows"},tablet:{name:"iPad",width:1024,height:768,material_icon:"tablet"}},e.setDevice=function(t){e.device=t,console.log("set device:",t)},e.setSlide=function(t){e.selected=t,console.log(t)},e.loading=!1,e.search=function(){e.searching=!0,i(function(){$("#search").focus()})},e.$on("device-ready",function(){e.setDevice(e.devices.tablet),e.loading=!1}),e.fn={tags:{search:function(t){console.log("query",t);var n=[];return angular.forEach(e.config.tags,function(e){e.text.includes(t)&&n.push(e.text)}),n}}}}]),angular.module("alpacaEditor").directive("alpacaForm",["$compile","$templateRequest",function(e,t){var n=function(n,i,r){t("alpaca-type-"+n.slide.template).then(function(t){var r=angular.element(t);i.after(r),e(r)(n)})};return{restrict:"E",link:n}}]),angular.module("alpacaEditor").directive("alpacaField",["$compile","$templateRequest",function(e,t){var n=function(n,i,r){t("alpaca-type-"+n.type).then(function(t){var r=angular.element(t);i.after(r),e(r)(n)})};return{restrict:"E",link:n,scope:{model:"=",type:"=",field:"=",fn:"=",slide:"=",templates:"="}}}]),angular.module("alpacaEditor").filter("toArray",function(){return function(e,t){return angular.isObject(e)?t===!1?Object.keys(e).map(function(t){return e[t]}):Object.keys(e).map(function(t){var n=e[t];return angular.isObject(n)?Object.defineProperty(n,"$key",{enumerable:!1,value:t}):{$key:t,$value:n}}):e}}),angular.module("alpacaEditor").directive("ngEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.ngEnter)}),t.preventDefault())})}}),angular.module("alpacaEditor").directive("devicePreview",function(){var e=function(e,t,n){var i=angular.element(t).parent(),r=angular.element(t);r.css({background:"white"}),i.css({display:"flex","align-items":"center","justify-content":"center"}),e.$watch("device",function(){var n=e.device;if(!angular.element(t).parent()[0])return!1;i.width=e.$parent.frame_size.width,i.height=e.$parent.frame_size.height,console.log(e.device);var a=i.width/i.height>n.width/n.height,o=a?i.height/n.height:i.width/n.width,s=a?n.width*i.height/n.height:i.width,l=a?i.height:n.height*i.width/n.width;r.css({transform:"scale("+o+")",width:s/o+"px",height:l/o+"px"});var u={x:Math.max(n.width,s),y:Math.max(n.height,l)},c={x:-1*((u.x-i.width)/2),y:-1*((u.y-i.height)/2)};e.$parent.iframe.css({width:u.x,height:u.y,transform:"translate("+c.x+"px,"+c.y+"px)"}),console.log("device",n.width,n.height),console.log("parent",i.width,i.height),console.log("scale",o),console.log("new",s,l)})};return{restrict:"E",link:e,scope:{device:"="}}}),angular.module("alpacaEditor").directive("wrapInFrame",["$compile","$timeout",function(e,t){return{restrict:"E",scope:{},transclude:!0,replace:!1,link:function(t,n,i,r,a){t.$parent.frame_size={width:n.parent().width(),height:n.parent().height()},a(t.$parent,function(i,r){n.html("<iframe width='100%' height='100%'>");var a=n.find("iframe")[0];t.$parent.iframe=angular.element(a),a.onload=function(){t.$parent.linked=!0;var n=angular.element(a.contentWindow.document.body);$("link[rel='stylesheet'], link[type='text/css'], link[href$='.css']").clone().appendTo($("iframe").contents().find("head")),$('<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/>').appendTo($("iframe").contents().find("head")),e(i)(t.$parent,function(e){n.append(e),t.$parent.$emit("device-ready")})},a.src=""})}}}]);
//# sourceMappingURL=alpaca-editor.min.js.map
