!function(e){function t(e,t){return"all"==t?e:e.filter(function(e){return t.toLowerCase().indexOf(e)!=-1})}var i="application/x-dnd",n="application/json",r="Text",s=["move","copy","link"];e.directive("dndDraggable",["$parse","$timeout",function(e,o){return function(l,d,u){d.attr("draggable","true"),u.dndDisableIf&&l.$watch(u.dndDisableIf,function(e){d.attr("draggable",!e)}),d.on("dragstart",function(f){if(f=f.originalEvent||f,"false"==d.attr("draggable"))return!0;a.isDragging=!0,a.itemType=u.dndType&&l.$eval(u.dndType).toLowerCase(),a.dropEffect="none",a.effectAllowed=u.dndEffectAllowed||s[0],f.dataTransfer.effectAllowed=a.effectAllowed;var c=l.$eval(u.dndDraggable),h=i+(a.itemType?"-"+a.itemType:"");try{f.dataTransfer.setData(h,angular.toJson(c))}catch(e){var p=angular.toJson({item:c,type:a.itemType});try{f.dataTransfer.setData(n,p)}catch(e){var g=t(s,a.effectAllowed);f.dataTransfer.effectAllowed=g[0],f.dataTransfer.setData(r,p)}}if(d.addClass("dndDragging"),o(function(){d.addClass("dndDraggingSource")},0),f._dndHandle&&f.dataTransfer.setDragImage&&f.dataTransfer.setDragImage(d[0],0,0),e(u.dndDragstart)(l,{event:f}),u.dndCallback){var v=e(u.dndCallback);a.callback=function(e){return v(l,e||{})}}f.stopPropagation()}),d.on("dragend",function(t){t=t.originalEvent||t,l.$apply(function(){var i=a.dropEffect,n={copy:"dndCopied",link:"dndLinked",move:"dndMoved",none:"dndCanceled"};e(u[n[i]])(l,{event:t}),e(u.dndDragend)(l,{event:t,dropEffect:i})}),a.isDragging=!1,a.callback=void 0,d.removeClass("dndDragging"),d.removeClass("dndDraggingSource"),t.stopPropagation(),o(function(){d.removeClass("dndDraggingSource")},0)}),d.on("click",function(t){u.dndSelected&&(t=t.originalEvent||t,l.$apply(function(){e(u.dndSelected)(l,{event:t})}),t.stopPropagation())}),d.on("selectstart",function(){this.dragDrop&&this.dragDrop()})}}]),e.directive("dndList",["$parse",function(e){return function(o,l,d){function u(e){if(!e)return r;for(var t=0;t<e.length;t++)if(e[t]==r||e[t]==n||e[t].substr(0,i.length)==i)return e[t];return null}function f(e){return a.isDragging?a.itemType||void 0:e==r||e==n?null:e&&e.substr(i.length+1)||void 0}function c(e){return!k.disabled&&(!(!k.externalSources&&!a.isDragging)&&(!k.allowedTypes||null===e||e&&k.allowedTypes.indexOf(e)!=-1))}function h(e,i){var n=s;return i||(n=t(n,e.dataTransfer.effectAllowed)),a.isDragging&&(n=t(n,a.effectAllowed)),d.dndEffectAllowed&&(n=t(n,d.dndEffectAllowed)),n.length?e.ctrlKey&&n.indexOf("copy")!=-1?"copy":e.altKey&&n.indexOf("link")!=-1?"link":n[0]:"none"}function p(){return w.remove(),l.removeClass("dndDragover"),!0}function g(t,i,n,r,s,l){return e(t)(o,{callback:a.callback,dropEffect:n,event:i,external:!a.isDragging,index:void 0!==s?s:v(),item:l||void 0,type:r})}function v(){return Array.prototype.indexOf.call(y.children,b)}function m(){var e;return angular.forEach(l.children(),function(t){var i=angular.element(t);i.hasClass("dndPlaceholder")&&(e=i)}),e||angular.element("<li class='dndPlaceholder'></li>")}var w=m();w.remove();var b=w[0],y=l[0],k={};l.on("dragenter",function(e){e=e.originalEvent||e;var t=d.dndAllowedTypes&&o.$eval(d.dndAllowedTypes);k={allowedTypes:angular.isArray(t)&&t.join("|").toLowerCase().split("|"),disabled:d.dndDisableIf&&o.$eval(d.dndDisableIf),externalSources:d.dndExternalSources&&o.$eval(d.dndExternalSources),horizontal:d.dndHorizontalList&&o.$eval(d.dndHorizontalList)};var i=u(e.dataTransfer.types);return!i||!c(f(i))||void e.preventDefault()}),l.on("dragover",function(e){e=e.originalEvent||e;var t=u(e.dataTransfer.types),i=f(t);if(!t||!c(i))return!0;if(b.parentNode!=y&&l.append(w),e.target!=y){for(var n=e.target;n.parentNode!=y&&n.parentNode;)n=n.parentNode;if(n.parentNode==y&&n!=b){var s=n.getBoundingClientRect();if(k.horizontal)var a=e.clientX<s.left+s.width/2;else var a=e.clientY<s.top+s.height/2;y.insertBefore(b,a?n:n.nextSibling)}}var o=t==r,v=h(e,o);return"none"==v?p():d.dndDragover&&!g(d.dndDragover,e,v,i)?p():(e.preventDefault(),o||(e.dataTransfer.dropEffect=v),l.addClass("dndDragover"),e.stopPropagation(),!1)}),l.on("drop",function(e){e=e.originalEvent||e;var t=u(e.dataTransfer.types),i=f(t);if(!t||!c(i))return!0;e.preventDefault();try{var s=JSON.parse(e.dataTransfer.getData(t))}catch(e){return p()}if((t==r||t==n)&&(i=s.type||void 0,s=s.item,!c(i)))return p();var l=t==r,m=h(e,l);if("none"==m)return p();var w=v();return d.dndDrop&&(s=g(d.dndDrop,e,m,i,w,s),!s)?p():(a.dropEffect=m,l||(e.dataTransfer.dropEffect=m),s!==!0&&o.$apply(function(){o.$eval(d.dndList).splice(w,0,s)}),g(d.dndInserted,e,m,i,w,s),p(),e.stopPropagation(),!1)}),l.on("dragleave",function(e){e=e.originalEvent||e;var t=document.elementFromPoint(e.clientX,e.clientY);y.contains(t)&&!e._dndPhShown?e._dndPhShown=!0:p()})}}]),e.directive("dndNodrag",function(){return function(e,t,i){t.attr("draggable","true"),t.on("dragstart",function(e){e=e.originalEvent||e,e._dndHandle||(e.dataTransfer.types&&e.dataTransfer.types.length||e.preventDefault(),e.stopPropagation())}),t.on("dragend",function(e){e=e.originalEvent||e,e._dndHandle||e.stopPropagation()})}}),e.directive("dndHandle",function(){return function(e,t,i){t.attr("draggable","true"),t.on("dragstart dragend",function(e){e=e.originalEvent||e,e._dndHandle=!0})}});var a={}}(angular.module("dndLists",[])),function(e,t,i){"use strict";function n(t){if(this.support=!("undefined"==typeof File||"undefined"==typeof Blob||"undefined"==typeof FileList||!Blob.prototype.slice&&!Blob.prototype.webkitSlice&&!Blob.prototype.mozSlice),this.support){this.supportDirectory=/Chrome/.test(e.navigator.userAgent),this.files=[],this.defaults={chunkSize:1048576,forceChunkSize:!1,simultaneousUploads:3,singleFile:!1,fileParameterName:"file",progressCallbacksInterval:500,speedSmoothingFactor:.1,query:{},headers:{},withCredentials:!1,preprocess:null,method:"multipart",testMethod:"GET",uploadMethod:"POST",prioritizeFirstAndLastChunk:!1,allowDuplicateUploads:!1,target:"/",testChunks:!0,generateUniqueIdentifier:null,maxChunkRetries:0,chunkRetryInterval:null,permanentErrors:[404,413,415,500,501],successStatuses:[200,201,202],onDropStopPropagation:!1,initFileFn:null,readFileFn:s},this.opts={},this.events={};var i=this;this.onDrop=function(e){i.opts.onDropStopPropagation&&e.stopPropagation(),e.preventDefault();var t=e.dataTransfer;t.items&&t.items[0]&&t.items[0].webkitGetAsEntry?i.webkitReadDataTransfer(e):i.addFiles(t.files,e)},this.preventEvent=function(e){e.preventDefault()},this.opts=n.extend({},this.defaults,t||{})}}function r(e,t){this.flowObj=e,this.bytes=null,this.file=t,this.name=t.fileName||t.name,this.size=t.size,this.relativePath=t.relativePath||t.webkitRelativePath||this.name,this.uniqueIdentifier=e.generateUniqueIdentifier(t),this.chunks=[],this.paused=!1,this.error=!1,this.averageSpeed=0,this.currentSpeed=0,this._lastProgressCallback=Date.now(),this._prevUploadedSize=0,this._prevProgress=0,this.bootstrap()}function s(e,t,i,n,r){var s="slice";e.file.slice?s="slice":e.file.mozSlice?s="mozSlice":e.file.webkitSlice&&(s="webkitSlice"),r.readFinished(e.file[s](t,i,n))}function a(e,t,i){this.flowObj=e,this.fileObj=t,this.offset=i,this.tested=!1,this.retries=0,this.pendingRetry=!1,this.preprocessState=0,this.readState=0,this.loaded=0,this.total=0,this.chunkSize=this.flowObj.opts.chunkSize,this.startByte=this.offset*this.chunkSize,this.computeEndByte=function(){var e=Math.min(this.fileObj.size,(this.offset+1)*this.chunkSize);return this.fileObj.size-e<this.chunkSize&&!this.flowObj.opts.forceChunkSize&&(e=this.fileObj.size),e},this.endByte=this.computeEndByte(),this.xhr=null;var n=this;this.event=function(e,t){t=Array.prototype.slice.call(arguments),t.unshift(n),n.fileObj.chunkEvent.apply(n.fileObj,t)},this.progressHandler=function(e){e.lengthComputable&&(n.loaded=e.loaded,n.total=e.total),n.event("progress",e)},this.testHandler=function(e){var t=n.status(!0);"error"===t?(n.event(t,n.message()),n.flowObj.uploadNextChunk()):"success"===t?(n.tested=!0,n.event(t,n.message()),n.flowObj.uploadNextChunk()):n.fileObj.paused||(n.tested=!0,n.send())},this.doneHandler=function(e){var t=n.status();if("success"===t||"error"===t)delete this.data,n.event(t,n.message()),n.flowObj.uploadNextChunk();else{n.event("retry",n.message()),n.pendingRetry=!0,n.abort(),n.retries++;var i=n.flowObj.opts.chunkRetryInterval;null!==i?setTimeout(function(){n.send()},i):n.send()}}}function o(e,t){var i=e.indexOf(t);i>-1&&e.splice(i,1)}function l(e,t){return"function"==typeof e&&(t=Array.prototype.slice.call(arguments),e=e.apply(null,t.slice(1))),e}function d(e,t){setTimeout(e.bind(t),0)}function u(e,t){return f(arguments,function(t){t!==e&&f(t,function(t,i){e[i]=t})}),e}function f(e,t,i){if(e){var n;if("undefined"!=typeof e.length){for(n=0;n<e.length;n++)if(t.call(i,e[n],n)===!1)return}else for(n in e)if(e.hasOwnProperty(n)&&t.call(i,e[n],n)===!1)return}}var c=e.navigator.msPointerEnabled;n.prototype={on:function(e,t){e=e.toLowerCase(),this.events.hasOwnProperty(e)||(this.events[e]=[]),this.events[e].push(t)},off:function(e,t){e!==i?(e=e.toLowerCase(),t!==i?this.events.hasOwnProperty(e)&&o(this.events[e],t):delete this.events[e]):this.events={}},fire:function(e,t){t=Array.prototype.slice.call(arguments),e=e.toLowerCase();var i=!1;return this.events.hasOwnProperty(e)&&f(this.events[e],function(e){i=e.apply(this,t.slice(1))===!1||i},this),"catchall"!=e&&(t.unshift("catchAll"),i=this.fire.apply(this,t)===!1||i),!i},webkitReadDataTransfer:function(e){function t(e){e.readEntries(function(s){s.length?(a+=s.length,f(s,function(e){if(e.isFile){var r=e.fullPath;e.file(function(e){i(e,r)},n)}else e.isDirectory&&t(e.createReader())}),t(e)):r()},n)}function i(e,t){e.relativePath=t.substring(1),o.push(e),r()}function n(e){throw e}function r(){0==--a&&s.addFiles(o,e)}var s=this,a=e.dataTransfer.items.length,o=[];f(e.dataTransfer.items,function(e){var n=e.webkitGetAsEntry();return n?void(n.isFile?i(e.getAsFile(),n.fullPath):t(n.createReader())):void r()})},generateUniqueIdentifier:function(e){var t=this.opts.generateUniqueIdentifier;if("function"==typeof t)return t(e);var i=e.relativePath||e.webkitRelativePath||e.fileName||e.name;return e.size+"-"+i.replace(/[^0-9a-zA-Z_-]/gim,"")},uploadNextChunk:function(e){var t=!1;if(this.opts.prioritizeFirstAndLastChunk&&(f(this.files,function(e){return!e.paused&&e.chunks.length&&"pending"===e.chunks[0].status()?(e.chunks[0].send(),t=!0,!1):!e.paused&&e.chunks.length>1&&"pending"===e.chunks[e.chunks.length-1].status()?(e.chunks[e.chunks.length-1].send(),t=!0,!1):void 0}),t))return t;if(f(this.files,function(e){if(e.paused||f(e.chunks,function(e){if("pending"===e.status())return e.send(),t=!0,!1}),t)return!1}),t)return!0;var i=!1;return f(this.files,function(e){if(!e.isComplete())return i=!0,!1}),i||e||d(function(){this.fire("complete")},this),!1},assignBrowse:function(e,i,n,r){e instanceof Element&&(e=[e]),f(e,function(e){var s;"INPUT"===e.tagName&&"file"===e.type?s=e:(s=t.createElement("input"),s.setAttribute("type","file"),u(s.style,{visibility:"hidden",position:"absolute",width:"1px",height:"1px"}),e.appendChild(s),e.addEventListener("click",function(){s.click()},!1)),this.opts.singleFile||n||s.setAttribute("multiple","multiple"),i&&s.setAttribute("webkitdirectory","webkitdirectory"),f(r,function(e,t){s.setAttribute(t,e)});var a=this;s.addEventListener("change",function(e){e.target.value&&(a.addFiles(e.target.files,e),e.target.value="")},!1)},this)},assignDrop:function(e){"undefined"==typeof e.length&&(e=[e]),f(e,function(e){e.addEventListener("dragover",this.preventEvent,!1),e.addEventListener("dragenter",this.preventEvent,!1),e.addEventListener("drop",this.onDrop,!1)},this)},unAssignDrop:function(e){"undefined"==typeof e.length&&(e=[e]),f(e,function(e){e.removeEventListener("dragover",this.preventEvent),e.removeEventListener("dragenter",this.preventEvent),e.removeEventListener("drop",this.onDrop)},this)},isUploading:function(){var e=!1;return f(this.files,function(t){if(t.isUploading())return e=!0,!1}),e},_shouldUploadNext:function(){var e=0,t=!0,i=this.opts.simultaneousUploads;return f(this.files,function(n){f(n.chunks,function(n){if("uploading"===n.status()&&(e++,e>=i))return t=!1,!1})}),t&&e},upload:function(){var e=this._shouldUploadNext();if(e!==!1){this.fire("uploadStart");for(var t=!1,i=1;i<=this.opts.simultaneousUploads-e;i++)t=this.uploadNextChunk(!0)||t;t||d(function(){this.fire("complete")},this)}},resume:function(){f(this.files,function(e){e.resume()})},pause:function(){f(this.files,function(e){e.pause()})},cancel:function(){for(var e=this.files.length-1;e>=0;e--)this.files[e].cancel()},progress:function(){var e=0,t=0;return f(this.files,function(i){e+=i.progress()*i.size,t+=i.size}),t>0?e/t:0},addFile:function(e,t){this.addFiles([e],t)},addFiles:function(e,t){var i=[];f(e,function(e){if((!c||c&&e.size>0)&&(e.size%4096!==0||"."!==e.name&&"."!==e.fileName)&&(this.opts.allowDuplicateUploads||!this.getFromUniqueIdentifier(this.generateUniqueIdentifier(e)))){var n=new r(this,e);this.fire("fileAdded",n,t)&&i.push(n)}},this),this.fire("filesAdded",i,t)&&(f(i,function(e){this.opts.singleFile&&this.files.length>0&&this.removeFile(this.files[0]),this.files.push(e)},this),this.fire("filesSubmitted",i,t))},removeFile:function(e){for(var t=this.files.length-1;t>=0;t--)this.files[t]===e&&(this.files.splice(t,1),e.abort(),this.fire("fileRemoved",e))},getFromUniqueIdentifier:function(e){var t=!1;return f(this.files,function(i){i.uniqueIdentifier===e&&(t=i)}),t},getSize:function(){var e=0;return f(this.files,function(t){e+=t.size}),e},sizeUploaded:function(){var e=0;return f(this.files,function(t){e+=t.sizeUploaded()}),e},timeRemaining:function(){var e=0,t=0;return f(this.files,function(i){i.paused||i.error||(e+=i.size-i.sizeUploaded(),t+=i.averageSpeed)}),e&&!t?Number.POSITIVE_INFINITY:e||t?Math.floor(e/t):0}},r.prototype={measureSpeed:function(){var e=Date.now()-this._lastProgressCallback;if(e){var t=this.flowObj.opts.speedSmoothingFactor,i=this.sizeUploaded();this.currentSpeed=Math.max((i-this._prevUploadedSize)/e*1e3,0),this.averageSpeed=t*this.currentSpeed+(1-t)*this.averageSpeed,this._prevUploadedSize=i}},chunkEvent:function(e,t,i){switch(t){case"progress":if(Date.now()-this._lastProgressCallback<this.flowObj.opts.progressCallbacksInterval)break;this.measureSpeed(),this.flowObj.fire("fileProgress",this,e),this.flowObj.fire("progress"),this._lastProgressCallback=Date.now();break;case"error":this.error=!0,this.abort(!0),this.flowObj.fire("fileError",this,i,e),this.flowObj.fire("error",i,this,e);break;case"success":if(this.error)return;this.measureSpeed(),this.flowObj.fire("fileProgress",this,e),this.flowObj.fire("progress"),this._lastProgressCallback=Date.now(),this.isComplete()&&(this.currentSpeed=0,this.averageSpeed=0,this.flowObj.fire("fileSuccess",this,i,e));break;case"retry":this.flowObj.fire("fileRetry",this,e)}},pause:function(){this.paused=!0,this.abort()},resume:function(){this.paused=!1,this.flowObj.upload()},abort:function(e){this.currentSpeed=0,this.averageSpeed=0;var t=this.chunks;e&&(this.chunks=[]),f(t,function(e){"uploading"===e.status()&&(e.abort(),this.flowObj.uploadNextChunk())},this)},cancel:function(){this.flowObj.removeFile(this)},retry:function(){this.bootstrap(),this.flowObj.upload()},bootstrap:function(){"function"==typeof this.flowObj.opts.initFileFn&&this.flowObj.opts.initFileFn(this),this.abort(!0),this.error=!1,this._prevProgress=0;for(var e=this.flowObj.opts.forceChunkSize?Math.ceil:Math.floor,t=Math.max(e(this.size/this.flowObj.opts.chunkSize),1),i=0;i<t;i++)this.chunks.push(new a(this.flowObj,this,i))},progress:function(){if(this.error)return 1;if(1===this.chunks.length)return this._prevProgress=Math.max(this._prevProgress,this.chunks[0].progress()),this._prevProgress;var e=0;f(this.chunks,function(t){e+=t.progress()*(t.endByte-t.startByte)});var t=e/this.size;return this._prevProgress=Math.max(this._prevProgress,t>.9999?1:t),this._prevProgress},isUploading:function(){var e=!1;return f(this.chunks,function(t){if("uploading"===t.status())return e=!0,!1}),e},isComplete:function(){var e=!1;return f(this.chunks,function(t){var i=t.status();if("pending"===i||"uploading"===i||"reading"===i||1===t.preprocessState||1===t.readState)return e=!0,!1}),!e},sizeUploaded:function(){var e=0;return f(this.chunks,function(t){e+=t.sizeUploaded()}),e},timeRemaining:function(){if(this.paused||this.error)return 0;var e=this.size-this.sizeUploaded();return e&&!this.averageSpeed?Number.POSITIVE_INFINITY:e||this.averageSpeed?Math.floor(e/this.averageSpeed):0},getType:function(){return this.file.type&&this.file.type.split("/")[1]},getExtension:function(){return this.name.substr((~-this.name.lastIndexOf(".")>>>0)+2).toLowerCase()}},a.prototype={getParams:function(){return{flowChunkNumber:this.offset+1,flowChunkSize:this.flowObj.opts.chunkSize,flowCurrentChunkSize:this.endByte-this.startByte,flowTotalSize:this.fileObj.size,flowIdentifier:this.fileObj.uniqueIdentifier,flowFilename:this.fileObj.name,flowRelativePath:this.fileObj.relativePath,flowTotalChunks:this.fileObj.chunks.length}},getTarget:function(e,t){return e+=e.indexOf("?")<0?"?":"&",e+t.join("&")},test:function(){this.xhr=new XMLHttpRequest,this.xhr.addEventListener("load",this.testHandler,!1),this.xhr.addEventListener("error",this.testHandler,!1);var e=l(this.flowObj.opts.testMethod,this.fileObj,this),t=this.prepareXhrRequest(e,!0);this.xhr.send(t)},preprocessFinished:function(){this.endByte=this.computeEndByte(),this.preprocessState=2,this.send()},readFinished:function(e){this.readState=2,this.bytes=e,this.send()},send:function(){var e=this.flowObj.opts.preprocess,t=this.flowObj.opts.readFileFn;if("function"==typeof e)switch(this.preprocessState){case 0:return this.preprocessState=1,void e(this);case 1:return}switch(this.readState){case 0:return this.readState=1,void t(this.fileObj,this.startByte,this.endByte,this.fileObj.file.type,this);case 1:return}if(this.flowObj.opts.testChunks&&!this.tested)return void this.test();this.loaded=0,this.total=0,this.pendingRetry=!1,this.xhr=new XMLHttpRequest,this.xhr.upload.addEventListener("progress",this.progressHandler,!1),this.xhr.addEventListener("load",this.doneHandler,!1),this.xhr.addEventListener("error",this.doneHandler,!1);var i=l(this.flowObj.opts.uploadMethod,this.fileObj,this),n=this.prepareXhrRequest(i,!1,this.flowObj.opts.method,this.bytes);this.xhr.send(n)},abort:function(){var e=this.xhr;this.xhr=null,e&&e.abort()},status:function(e){return 1===this.readState?"reading":this.pendingRetry||1===this.preprocessState?"uploading":this.xhr?this.xhr.readyState<4?"uploading":this.flowObj.opts.successStatuses.indexOf(this.xhr.status)>-1?"success":this.flowObj.opts.permanentErrors.indexOf(this.xhr.status)>-1||!e&&this.retries>=this.flowObj.opts.maxChunkRetries?"error":(this.abort(),"pending"):"pending"},message:function(){return this.xhr?this.xhr.responseText:""},progress:function(){if(this.pendingRetry)return 0;var e=this.status();return"success"===e||"error"===e?1:"pending"===e?0:this.total>0?this.loaded/this.total:0},sizeUploaded:function(){var e=this.endByte-this.startByte;return"success"!==this.status()&&(e=this.progress()*e),e},prepareXhrRequest:function(e,t,i,n){var r=l(this.flowObj.opts.query,this.fileObj,this,t);r=u(r,this.getParams());var s=l(this.flowObj.opts.target,this.fileObj,this,t),a=null;if("GET"===e||"octet"===i){var o=[];f(r,function(e,t){o.push([encodeURIComponent(t),encodeURIComponent(e)].join("="))}),s=this.getTarget(s,o),a=n||null}else a=new FormData,f(r,function(e,t){a.append(t,e)}),a.append(this.flowObj.opts.fileParameterName,n,this.fileObj.file.name);return this.xhr.open(e,s,!0),this.xhr.withCredentials=this.flowObj.opts.withCredentials,f(l(this.flowObj.opts.headers,this.fileObj,this,t),function(e,t){this.xhr.setRequestHeader(t,e)},this),a}},n.evalOpts=l,n.extend=u,n.each=f,n.FlowFile=r,n.FlowChunk=a,n.version="2.11.2","object"==typeof module&&module&&"object"==typeof module.exports?module.exports=n:(e.Flow=n,"function"==typeof define&&define.amd&&define("flow",[],function(){return n}))}(window,document),angular.module("flow.provider",[]).provider("flowFactory",function(){"use strict";this.defaults={},this.factory=function(e){return new Flow(e)},this.events=[],this.on=function(e,t){this.events.push([e,t])},this.$get=function(){var e=this.factory,t=this.defaults,i=this.events;return{create:function(n){var r=e(angular.extend({},t,n));return angular.forEach(i,function(e){r.on(e[0],e[1])}),r}}}}),angular.module("flow.init",["flow.provider"]).controller("flowCtrl",["$scope","$attrs","$parse","flowFactory",function(e,t,i,n){var r=angular.extend({},e.$eval(t.flowInit)),s=e.$eval(t.flowObject)||n.create(r),a=function(t){var i=Array.prototype.slice.call(arguments);i.shift();var n=e.$broadcast.apply(e,["flow::"+t,s].concat(i));if({progress:1,filesSubmitted:1,fileSuccess:1,fileError:1,complete:1}[t]&&e.$apply(),n.defaultPrevented)return!1};s.on("catchAll",a),e.$on("$destroy",function(){s.off("catchAll",a)}),e.$flow=s,t.hasOwnProperty("flowName")&&(i(t.flowName).assign(e,s),e.$on("$destroy",function(){i(t.flowName).assign(e)}))}]).directive("flowInit",[function(){return{scope:!0,controller:"flowCtrl"}}]),angular.module("flow.btn",["flow.init"]).directive("flowBtn",[function(){return{restrict:"EA",scope:!1,require:"^flowInit",link:function(e,t,i){var n=i.hasOwnProperty("flowDirectory"),r=i.hasOwnProperty("flowSingleFile"),s=i.hasOwnProperty("flowAttrs")&&e.$eval(i.flowAttrs);e.$flow.assignBrowse(t,n,r,s)}}}]),angular.module("flow.dragEvents",["flow.init"]).directive("flowPreventDrop",function(){return{scope:!1,link:function(e,t,i){t.bind("drop dragover",function(e){e.preventDefault()})}}}).directive("flowDragEnter",["$timeout",function(e){return{scope:!1,link:function(t,i,n){function r(e){var t=!1,i=e.dataTransfer||e.originalEvent.dataTransfer;return angular.forEach(i&&i.types,function(e){"Files"===e&&(t=!0)}),t}var s,a=!1;i.bind("dragover",function(i){r(i)&&(a||(t.$apply(n.flowDragEnter),a=!0),e.cancel(s),i.preventDefault())}),i.bind("dragleave drop",function(i){e.cancel(s),s=e(function(){t.$eval(n.flowDragLeave),s=null,a=!1},100)})}}}]),angular.module("flow.drop",["flow.init"]).directive("flowDrop",function(){return{scope:!1,require:"^flowInit",link:function(e,t,i){function n(){e.$flow.assignDrop(t)}function r(){e.$flow.unAssignDrop(t)}i.flowDropEnabled?e.$watch(i.flowDropEnabled,function(e){e?n():r()}):n()}}}),!function(e){"use strict";function t(e){return e.charAt(0).toUpperCase()+e.slice(1)}var i=e.module("flow.events",["flow.init"]),n={fileSuccess:["$file","$message"],fileProgress:["$file"],fileAdded:["$file","$event"],filesAdded:["$files","$event"],filesSubmitted:["$files","$event"],fileRetry:["$file"],fileError:["$file","$message"],uploadStart:[],complete:[],progress:[],error:["$message","$file"]};e.forEach(n,function(n,r){var s="flow"+t(r);"flowUploadStart"==s&&(s="flowUploadStarted"),i.directive(s,[function(){return{require:"^flowInit",controller:["$scope","$attrs",function(t,i){t.$on("flow::"+r,function(){var r=Array.prototype.slice.call(arguments),a=r.shift();if(t.$flow===r.shift()){var o={};e.forEach(n,function(e,t){o[e]=r[t]}),t.$eval(i[s],o)===!1&&a.preventDefault()}})}]}}])})}(angular),angular.module("flow.img",["flow.init"]).directive("flowImg",[function(){return{scope:!1,require:"^flowInit",link:function(e,t,i){var n=i.flowImg;e.$watch(n,function(t){if(t){var n=new FileReader;n.readAsDataURL(t.file),n.onload=function(t){e.$apply(function(){i.$set("src",t.target.result)})}}})}}}]),angular.module("flow.transfers",["flow.init"]).directive("flowTransfers",[function(){return{scope:!0,require:"^flowInit",link:function(e){e.transfers=e.$flow.files}}}]),angular.module("flow",["flow.provider","flow.init","flow.events","flow.btn","flow.drop","flow.transfers","flow.img","flow.dragEvents"]),angular.module("angularResizable",[]).directive("resizable",function(){function e(e){void 0===t?(t=e,setTimeout(function(){t(),t=void 0},100)):t=e}var t;return{restrict:"AE",scope:{rDirections:"=",rCenteredX:"=",rCenteredY:"=",rWidth:"=",rHeight:"=",rFlex:"=",rGrabber:"@",rDisabled:"@",rNoThrottle:"="},link:function(t,i,n){var r="flexBasis"in document.documentElement.style?"flexBasis":"webkitFlexBasis"in document.documentElement.style?"webkitFlexBasis":"msFlexPreferredSize"in document.documentElement.style?"msFlexPreferredSize":"flexBasis";t.$watch("rWidth",function(e){i[0].style[t.rFlex?r:"width"]=t.rWidth+"px"}),t.$watch("rHeight",function(e){i[0].style[t.rFlex?r:"height"]=t.rHeight+"px"}),i.addClass("resizable");var s,a,o,l,d,u=window.getComputedStyle(i[0],null),f=t.rDirections||["right"],c=t.rCenteredX?2:1,h=t.rCenteredY?2:1,p=t.rGrabber?t.rGrabber:"<span></span>",g={},v=function(e){g.width=!1,g.height=!1,"x"===d?g.width=parseInt(i[0].style[t.rFlex?r:"width"]):g.height=parseInt(i[0].style[t.rFlex?r:"height"]),g.id=i[0].id,g.evt=e},m=function(e){return e.touches?e.touches[0].clientX:e.clientX},w=function(e){return e.touches?e.touches[0].clientY:e.clientY},b=function(n){function u(){t.$emit("angular-resizable.resizing",g)}var f,p="x"===d?o-m(n):o-w(n);switch(l){case"top":f=t.rFlex?r:"height",i[0].style[f]=a+p*h+"px";break;case"bottom":f=t.rFlex?r:"height",i[0].style[f]=a-p*h+"px";break;case"right":f=t.rFlex?r:"width",i[0].style[f]=s-p*c+"px";break;case"left":f=t.rFlex?r:"width",i[0].style[f]=s+p*c+"px"}v(n),t.rNoThrottle?u():e(u)},y=function(e){v(),t.$emit("angular-resizable.resizeEnd",g),t.$apply(),document.removeEventListener("mouseup",y,!1),document.removeEventListener("mousemove",b,!1),document.removeEventListener("touchend",y,!1),document.removeEventListener("touchmove",b,!1),i.removeClass("no-transition")},k=function(e,n){l=n,d="left"===l||"right"===l?"x":"y",o="x"===d?m(e):w(e),s=parseInt(u.getPropertyValue("width")),a=parseInt(u.getPropertyValue("height")),i.addClass("no-transition"),document.addEventListener("mouseup",y,!1),document.addEventListener("mousemove",b,!1),document.addEventListener("touchend",y,!1),document.addEventListener("touchmove",b,!1),e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,v(e),t.$emit("angular-resizable.resizeStart",g),t.$apply()};f.forEach(function(e){var n=document.createElement("div");n.setAttribute("class","rg-"+e),n.innerHTML=p,i[0].appendChild(n),n.ondragstart=function(){return!1};var r=function(i){var n="true"===t.rDisabled;n||1!==i.which&&!i.touches||k(i,e)};n.addEventListener("mousedown",r,!1),n.addEventListener("touchstart",r,!1)})}}}),angular.module("alpacaEditor",["dndLists","swiperRepeat","flow","angularResizable","alpacaViewer","alpacaSchemas","alpacaTypes"]),angular.module("alpacaEditor").directive("alpacaForm",["$compile","$templateRequest",function(e,t){var i=function(i,n,r){t(i.model.template).then(function(t){var r=angular.element(t);n.after(r),e(r)(i)})};return{restrict:"E",link:i,scope:{model:"=",schema:"="}}}]),angular.module("alpacaEditor").controller("alpacaEditorController",["$scope","$templateList","$schemas","$timeout",function(e,t,i,n){e.templates=t.templates,console.log(t),e.survey={slides:{1:{id:1,title:"Slide 1",content:"Foo",template:"green"},2:{id:2,title:"Slide 2",content:"Bar",template:"orange"},3:{id:3,title:"Slide 3",content:"Fluf",template:"orange"}},nodes:{1:{id:1,title:"Slide 1",content:"Foo",template:"green"},2:{kind:"folder",title:"Smoking"},3:{id:3,title:"Slide 3",content:"Fluf",template:"orange"}}},e.selected=e.survey.slides[1],e.schemas=i.schemas,e.maximized=!1,e.maximizePreview=function(t){$(".resizable-wrapper").toggleClass("minimized"),e.maximized=!e.maximized},e.devices={iphone:{name:"iPhone",width:480,height:720,material_icon:"smartphone"},desktop:{name:"Desktop",width:1920,height:1080,material_icon:"desktop_windows"},tablet:{name:"Tablet",width:800,height:400,material_icon:"tablet"}},e.setDevice=function(t){e.device=t,console.log("set device:",t)},e.setSlide=function(t){e.selected=t,console.log(t)},e.loading=!0,e.search=function(){e.searching=!0,n(function(){$("#search").focus()})},e.$on("device-ready",function(){e.setDevice(e.devices.tablet),e.loading=!1}),e.fn={tags:{init:function(){$(".chips").material_chip(),console.log("loaded chips")}}}}]),angular.module("alpacaEditor").directive("alpacaForm",["$compile","$templateRequest",function(e,t){var i=function(i,n,r){t("alpaca-type-"+i.slide.template).then(function(t){var r=angular.element(t);n.after(r),e(r)(i)})};return{restrict:"E",link:i}}]),angular.module("alpacaEditor").directive("alpacaField",["$compile","$templateRequest",function(e,t){var i=function(i,n,r){console.log(i.type),t("alpaca-type-"+i.type).then(function(t){var r=angular.element(t);n.after(r),e(r)(i)})};return{restrict:"E",link:i,scope:{model:"=",type:"=",field:"=",fn:"="}}}]),angular.module("alpacaEditor").directive("devicePreview",function(){var e=function(e,t,i){var n=angular.element(t).parent();console.log("device-size",e.$parent.frame_size);var r=angular.element(t);e.$watch("device",function(){var i=e.device;if(!angular.element(t).parent()[0])return!1;n.width=e.$parent.frame_size.width,n.height=e.$parent.frame_size.height,console.log(e.device);var s=n.width/n.height>i.width/i.height,a=s?n.height/i.height:n.width/i.width,o=s?i.width*n.height/i.height:n.width,l=s?n.height:i.height*n.width/i.width;r.css({background:"white"}),n.css({display:"flex","align-items":"center","justify-content":"center"}),r.css({zoom:a,width:o/a+"px",height:l/a+"px"});var d={x:-1*((Math.max(i.width,o)-n.width)/2),y:-1*((Math.max(i.height,l)-n.height)/2)};e.$parent.iframe.css({width:Math.max(i.width,o),height:Math.max(i.height,l),transform:"translate("+d.x+"px,"+d.y+"px)"}),console.log("device",i.width,i.height),console.log("parent",n.width,n.height),console.log("scale",a),console.log("new",o,l)})};return{restrict:"E",link:e,scope:{device:"="}}}),angular.module("alpacaEditor").directive("wrapInFrame",["$compile","$timeout",function(e,t){return{restrict:"E",scope:{},transclude:!0,replace:!1,link:function(t,i,n,r,s){t.$parent.frame_size={width:i.parent().width(),height:i.parent().height()},s(t.$parent,function(n,r){i.html("<iframe width='100%' height='100%'>");var s=i.find("iframe")[0];t.$parent.iframe=angular.element(s),s.onload=function(){t.$parent.linked=!0;var i=angular.element(s.contentWindow.document.body);$("link[rel='stylesheet'], link[type='text/css'], link[href$='.css']").clone().appendTo($("iframe").contents().find("head")),$('<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/>').appendTo($("iframe").contents().find("head")),e(n)(t.$parent,function(e){i.append(e),t.$parent.$emit("device-ready")})},s.src=""})}}}]);
//# sourceMappingURL=alpaca-editor.min.js.map
